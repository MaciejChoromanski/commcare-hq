# -*- coding: utf-8 -*-
# Generated by Django 1.11.20 on 2019-04-11 20:31
from __future__ import absolute_import, unicode_literals

from django.db import migrations

from couchdbkit.exceptions import ResourceNotFound

from toggle.models import Toggle

from corehq.toggles import all_toggles


def _assert_migrated(apps, schema_editor):
    for toggle in all_toggles():
        try:
            couch_toggle = Toggle.couch_get(toggle.slug)
        except ResourceNotFound:
            # force creation
            couch_toggle = Toggle(slug=toggle.slug, enabled_users=[])
        couch_toggle.save()


class Migration(migrations.Migration):

    dependencies = [
        ('toggle', '0001_initial'),
    ]

    operations = [
        migrations.RunPython(_assert_migrated, migrations.RunPython.noop)
    ]
